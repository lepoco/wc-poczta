/**
 * @package    WordPress
 * @subpackage WC Poczta - Self Pickup with WooCommerce
 *
 * @copyright  Copyright (c) 2020-2021, Leszek Pomianowski
 * @link       https://dev.lepo.co/
 * @license    GPL-3.0 https://www.gnu.org/licenses/gpl-3.0.txt
 *
 * @see https://docs.inpost24.com/pages/viewpage.action?pageId=7798862
 * @see https://odbiorwpunkcie.poczta-polska.pl/wp-content/uploads/2021/06/INSTRUKCJA-INTEGRACJI-06_2021.pdf
 * @see https://www.orlenpaczka.pl/wp-content/uploads/2021/08/API_ORLENPaczka_v_1-16-005_A.pdf
 */
class WC_POCZTA{constructor(){document.addEventListener("click",(function(e){e.target&&e.target.classList.contains("wc-poczta__button")&&(e.preventDefault(),WC_POCZTA.buttonClick(e))}))}static buttonClick(e){const t=e.target.dataset;t.hasOwnProperty("method")&&("wc_poczta_easy_pack"==t.method&&WC_POCZTA.showEasyPack(t),"wc_poczta_poczta"==t.method&&WC_POCZTA.showPoczta(t),"wc_poczta_orlen_paczka"==t.method&&WC_POCZTA.showOrlen(t))}static getAddress(){let e={},t="";return e=null!==document.querySelector('input[name="ship_to_different_address"]:checked')?{code:document.querySelector('input[name="shipping_postcode"]').value,city:document.querySelector('input[name="shipping_city"]').value,street1:document.querySelector('input[name="shipping_address_1"]').value,street2:document.querySelector('input[name="shipping_address_2"]').value}:{code:document.querySelector('input[name="billing_postcode"]').value,city:document.querySelector('input[name="billing_city"]').value,street1:document.querySelector('input[name="billing_address_1"]').value,street2:document.querySelector('input[name="billing_address_2"]').value},void 0!==e.street1&&(t+=e.street1),void 0!==e.street2&&(t+=" "+e.street2),void 0!==e.code&&(t+=" "+e.code),void 0!==e.city&&(t+=" "+e.city),t.trim()}static showEasyPack(e){let t=!1;e.hasOwnProperty("sGeolocation_enabled")&&"yes"===e.sGeolocation_enabled&&(t=!0);let a=[];a=e.hasOwnProperty("sPoints")?e.sPoints.toLowerCase().split(";"):["pop","parcel_locker"],easyPack.init({instance:"pl",defaultLocale:"pl",mapType:"osm",searchType:"osm",langSelection:!1,filters:!1,apiEndpoint:"https://api-pl-points.easypack24.net/v1",display:{showTypesFilters:!1,showSearchBar:!0},points:{types:a},map:{initialTypes:a,useGeolocation:t},customMapAndListInRow:{enabled:!1}});let c=easyPack.modalMap((function(e,t){t.closeModal(),WC_POCZTA.updateInputData(e,e.name,e.type,e.name,e.address.line1,e.address_details.post_code,e.address_details.city,e.address_details.province)}),{width:1e3,height:600});WC_POCZTA.getAddress().length>1&&c.searchPlace(WC_POCZTA.getAddress());let n=document.querySelector("#widget-modal");n&&n.parentNode.classList.add("wc-poczta__easypack-map")}static showPoczta(e){let t=[];t=e.hasOwnProperty("sPoints")?e.sPoints.toUpperCase().split(";"):["POCZTA","ZABKA","RUCH"];let a=WC_POCZTA.getAddress();a.length>1?PPWidgetApp.toggleMap({callback:WC_POCZTA.callbackPoczta,payOnPickup:!1,address:a,type:t}):PPWidgetApp.toggleMap({callback:WC_POCZTA.callbackPoczta,payOnPickup:!1,type:t})}static showOrlen(e){}static callbackPoczta(e){WC_POCZTA.updateInputData(e,e.pni,e.type,e.name,e.street,e.zipCode,e.city,e.province)}static updateInputData(e,t,a,c,n,o,i,s){if(Array.isArray(a)){let e="";for(let t=0;t<a.length;t++)e+=(t>0?";":"")+a[t];a=e}document.querySelector('input[name="wc-poczta__input--raw"]').value=JSON.stringify(e),document.querySelector('input[name="wc-poczta__input--id"]').value=t,document.querySelector('input[name="wc-poczta__input--type"]').value=a,document.querySelector('input[name="wc-poczta__input--name"]').value=c,document.querySelector('input[name="wc-poczta__input--city"]').value=i,document.querySelector('input[name="wc-poczta__input--address"]').value=n,document.querySelector('input[name="wc-poczta__input--zipcode"]').value=o,document.querySelector('input[name="wc-poczta__input--province"]').value=s,document.querySelector('input[name="wc-poczta__input--name"]').value=c,document.querySelector('input[name="wc-poczta__input--carrier"]').value=c,document.querySelector('input[name="wc-poczta__input--carrier_address"]').value=n+" "+i}}document.addEventListener("DOMContentLoaded",()=>new WC_POCZTA);